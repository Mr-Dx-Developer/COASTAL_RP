import{a as e,ai as De,r as i,p as _,q as T,j as s,w as Fe,L as o,N as he,aj as de,C as $,cs as ye,$ as ce,m as se,ct as Ve,O as ge,I as ve,az as Je,cr as Re,ac as Ne,ad as Pe,a4 as Ae,ci as Me,cu as xe,bb as Oe,R as we,a8 as Ee,F as te,d as ue,a5 as Xe,a0 as Qe,cg as Ge,u as fe,A as Se,aW as Be,cv as et,cw as We,b1 as tt,P as re,U as He,E as nt,S as $e,s as ie,cx as it,cy as st,cz as ot,cA as at,as as qe,J as Le,av as lt,an as rt,ao as ct,b as _e,bh as Ze,aC as ut,aD as dt,a7 as mt,bZ as ft,cl as ht,c3 as vt,cm as Tt,cn as be,cB as gt,c0 as Pt,cC as pt,cD as St,ck as Ct,bq as It}from"./index-5ca133d9.js";import{S as Nt}from"./Slider-f09ab906.js";function me(){return e("div",{className:"checkmark",children:e(De,{})})}const Z={Account:{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},Accounts:[{name:"LB",username:"lb",follower_count:2,following_count:2,like_count:543,video_count:2,avatar:"https://docs.lbscripts.com/images/icons/icon.png",bio:`Official LB account
https://lbphone.com`,twitter:"lb",instagram:"lb",verified:!0,following:["breze","loaf"],followers:["breze","loaf"]},{name:"Breze",username:"breze",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"breze",instagram:"breze",isFollowing:!0,following:["lb"],followers:["lb"]},{name:"Loaf Scripts",username:"loaf",follower_count:1,following_count:1,like_count:0,video_count:0,bio:"I'm a developer",twitter:"loaf",instagram:"loaf",isFollowing:!0,following:["lb"],followers:["lb"]}],Videos:[{id:"1",caption:"Trippy vibes",src:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",views:532,likes:16,comments:1,saves:1,commentsData:[{id:"1",username:"lb",name:"LB",verified:!0,avatar:"https://docs.lbscripts.com/images/icons/icon.png",comment:"First comment!",creator_liked:1,likes:1,liked:1,timestamp:Date.now()-1e3*60*60*2}],timestamp:Date.now()-1e3*60*60*8,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0},{id:"2",caption:"Car spotting in Los Santos",src:"https://r2.fivemanage.com/video/0NNIBeGAfx5J.mp4",views:1445,likes:123,comments:0,saves:3,commentsData:[],timestamp:Date.now()-1e3*60*60*24,username:"lb",name:"LB",avatar:"https://docs.lbscripts.com/images/icons/icon.png",verified:!0,following:!0}],Messages:[{id:"1",username:"breze",name:"Breze",verified:!0,last_message:"hey",unread_messages:1,following_count:12,follower_count:123,messages:[{id:"1",sender:"breze",content:"hey",timestamp:Date.now()-1e3*60*60*4}],timestamp:Date.now()-1e3*60*60*4},{id:"2",username:"loaf",name:"Loaf Scripts",verified:!1,last_message:"yoo, that vid was fire",unread_messages:0,following_count:4,follower_count:3,messages:[{id:"3",sender:"loaf",content:"yoo, that vid was fire",timestamp:Date.now()-1e3*60*60*8},{id:"1",sender:"lb",video:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",videoId:"1",timestamp:Date.now()-1e3*60*60*13}],timestamp:Date.now()-1e3*60*60*8}],Notifications:[{type:"like",username:"loaf",name:"Loaf Scripts",videoId:"1",videoSrc:"https://r2.fivemanage.com/video/NfFKTX2V0iJ1.mp4",timestamp:Date.now()-1e3*60*60*2},{type:"follow",username:"loaf",name:"Loaf Scripts",isFollowing:!0,followsYou:!0,timestamp:Date.now()-1e3*60*60*24*3}]};function ze(){return e("svg",{viewBox:"0 0 16 14",xmlns:"http://www.w3.org/2000/svg",children:e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.0203 0.108741C13.5601 -0.122158 15.75 1.87768 15.75 4.42804V4.49056C15.75 5.65597 15.2871 6.77366 14.463 7.59773L8.81009 13.2506C8.36271 13.698 7.63736 13.698 7.18998 13.2506L1.53704 7.59773C0.712962 6.77366 0.25 5.65597 0.25 4.49055V4.42806C0.25 1.87769 2.4399 -0.122157 4.97979 0.108742C6.17121 0.217053 7.26352 0.812457 8.00003 1.75171C8.73653 0.812457 9.82884 0.217052 11.0203 0.108741ZM14.25 4.42804C14.25 2.75973 12.8175 1.45154 11.1561 1.60258C10.3564 1.67528 9.625 2.08341 9.14323 2.72577L8.67378 3.3517C8.33691 3.80087 7.66317 3.80087 7.32629 3.35171L6.85681 2.72576C6.37504 2.08341 5.64364 1.67528 4.84399 1.60258C3.18252 1.45154 1.75 2.75974 1.75 4.42806V4.49055C1.75 5.25815 2.05493 5.9943 2.5977 6.53707L8.00003 11.9394L13.4023 6.53707C13.9451 5.9943 14.25 5.25815 14.25 4.49056V4.42804Z",fill:"currentColor"})})}function Ot(){const{User:t}=i.useContext(B),[d]=t,[h,P]=i.useState(""),[w,C]=i.useState(""),[u,v]=i.useState([]),[l,r]=i.useState([]),[n,a]=i.useState(0),[c,K]=i.useState(!1),[L,b]=i.useState(0),[I,N]=i.useState(!1),[U,M]=i.useState(!1);i.useEffect(()=>{_("TikTok",{action:"getVideos",data:{full:!0,type:"recent"},page:0},Z.Videos).then(A=>{if(!A)return T("warning","Failed to get videos");r(A)})},[]),i.useEffect(()=>{h.length>0&&_("TikTok",{action:"searchAccounts",query:h},Z.Accounts.filter(A=>A.username.includes(h))).then(A=>{if(!A)return T("info","No response, most likely no accounts to search for?");v(A)}),b(0),M(!1)},[h]),i.useEffect(()=>{const A=setTimeout(()=>P(w),500);return()=>clearTimeout(A)},[w]);const D=()=>{let A=h.length===0;if(A&&c)return T("info","Fetched everything, no need to fetch more (VIDEOS)");if(!A&&U)return T("info","Fetched everything, no need to fetch more (SEARCH)");if(I)return T("info","Already fetching");let O=document.querySelector("#last");if(!O)return T("warning","No last element");!he(O)&&(N(!0),_("TikTok",{action:A?"getVideos":"searchAccounts",query:h,data:{full:!0,type:"recent"},page:(A?n:L)+1},null).then(k=>{k&&k.length>0?(A?r(m=>[...m,...k]):v(m=>[...m,...k]),N(!1)):(N(!1),A?K(!0):M(!0))}),A?a(k=>k+1):b(k=>k+1))};return s("div",{className:"discover-container",children:[e("div",{className:"discover-header",children:e(Fe,{placeholder:o("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:A=>C(A.target.value)})}),h.length>0?e("div",{className:"search-results",onScroll:D,children:u==null?void 0:u.filter(A=>A.username!==d.username).map((A,O)=>e(wt,{data:A,last:u.length-1===O},O))}):e("div",{className:"discover-content",onScroll:D,children:l.map((A,O)=>e(At,{data:A,last:l.length-1===O},O))})]})}const wt=({data:t,last:d})=>{const{User:h,Func:P,GoBack:w}=i.useContext(B),[C,u]=w,[v,l]=i.useState(t.isFollowing),r=n=>{_("TikTok",{action:"toggleFollow",data:{username:t.username,follow:n}},!0).then(a=>{if(!a||!(a!=null&&a.success))return T("warning","Failed to toggle follow");if(a.error)return T("error",a.error);l(n)})};return s("div",{className:"item",id:d?"last":"",onClick:()=>{u({view:"discover"}),P.fetchAndSetProfile(t.username)},children:[s("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:j(t.avatar)})}),s("div",{className:"user",children:[s("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),s("div",{className:"stats",children:[X(t.followers)," ",o("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",X(t.videos)??"0"," ",o("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]}),e("div",{className:"action",children:e("div",{className:de("button",v?"following":"follow"),onClick:n=>{n.stopPropagation(),v?$.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>r(!1)}]}):r(!0)},children:v?o("APPS.TIKTOK.UNFOLLOW"):o("APPS.TIKTOK.FOLLOW")})})]})},At=({data:t,last:d})=>{const{Func:h,GoBack:P}=i.useContext(B),[w,C]=P;return s("div",{className:"item",id:d?"last":"",onClick:()=>{h.fetchAndSetVideo(t.id,{type:"recent"}),C({view:"discover"})},children:[s("div",{className:"video-item",children:[e("video",{src:t.src,loop:!0,onMouseEnter:u=>u.currentTarget.play(),onMouseLeave:u=>u.currentTarget.pause(),muted:!0}),e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),s("div",{className:"video-items",children:[e("div",{className:"caption",children:t.caption}),s("div",{className:"video-info",children:[s("div",{className:"user",onClick:u=>{u.stopPropagation(),C({view:"discover"}),h.fetchAndSetProfile(t.username)},children:[e("img",{src:j(t.avatar)}),e("div",{className:"name",children:t.username})]}),s("div",{className:"stats",children:[s("div",{children:[e(ye,{className:"plays"}),X(t.views)]}),s("div",{children:[e(ze,{}),X(t.likes)]})]})]})]})]})};function kt(){const{User:t,View:d,Dm:h}=i.useContext(B),[P,w]=d,[C,u]=h,[v,l]=i.useState(!1),[r,n]=i.useState([]);return i.useEffect(()=>{_("TikTok",{action:"getRecentMessages"},{success:!0,channels:Z.Messages}).then(a=>{if(!(a!=null&&a.success))return T("warning",a.error);n(a.channels)})},[]),ce("tiktok:receivedMessage",a=>{n(c=>{let K=c.findIndex(b=>b.channelId===a.channelId);if(K===-1)return c;let L=[...c];return L[K].lastMessage=a.content,L[K].lastMessageTimestamp=Date.now(),L})}),s(se.div,{...Ve,className:"messages-container",children:[e(ge,{children:v&&e(Kt,{close:()=>l(!1)})}),s("div",{className:"dmmessages-header",children:[e(ve,{onClick:()=>w("inbox")}),e("div",{className:"title",children:o("APPS.TIKTOK.DIRECT_MESSAGES")}),e(Je,{onClick:()=>l(!0)})]}),s("div",{className:"messages-body",children:[r.length===0&&s("div",{className:"no-messages",children:[e(Re,{}),e("div",{className:"title",children:o("APPS.TIKTOK.NO_MESSAGES_TITLE")}),e("div",{className:"content",children:o("APPS.TIKTOK.NO_MESSAGES_SUBTITLE")})]}),r.map((a,c)=>s("div",{className:"message","data-unread":a.unread_messages>0,onClick:()=>{u({id:a.id,name:a.name,username:a.username,avatar:a.avatar,verified:a.verified,follower_count:a.follower_count,following_count:a.following_count,video_count:a.video_count}),a.unread_messages>0&&_("TikTok",{action:"clearUnreadMessages",id:a.id}),w("dm")},children:[s("div",{className:"user",children:[e("img",{src:j(a.avatar)}),s("div",{className:"message-content",children:[e("div",{className:"username",children:a.name}),e("div",{className:"content",children:a.last_message})]})]}),e("div",{className:"timestamp",children:Ne(a.timestamp)})]},c))]})]})}const Kt=({close:t})=>{const{User:d}=i.useContext(B),[h]=d,[P,w]=i.useState(""),[C,u]=i.useState(""),[v,l]=i.useState([]);i.useEffect(()=>{const n=setTimeout(()=>w(C),500);return()=>clearTimeout(n)},[C]),i.useEffect(()=>{P.length>0&&_("TikTok",{action:"searchAccounts",query:P},{success:!0,accounts:Z.Accounts}).then(n=>{if(!n)return T("info","No response, most likely no accounts to search for?");l(n)})},[P]);const r=n=>{};return s(se.div,{...Pe,className:"search-container",children:[s("div",{className:"search-header",children:[e(Ae,{onClick:t}),e(Fe,{placeholder:o("APPS.TIKTOK.SEARCH_PLACEHOLDER"),onChange:n=>u(n.target.value)}),e("span",{})]}),e("div",{className:"search-results",onScroll:r,children:v==null?void 0:v.filter(n=>n.username!==h.username).map((n,a)=>e(Et,{data:n,last:v.length-1===a},a))})]})},Et=({data:t,last:d})=>{const{View:h,Dm:P}=i.useContext(B),[w,C]=h,[u,v]=P;return e("div",{className:"item",id:d?"last":"",onClick:()=>{v({name:t.name,username:t.username,avatar:t.avatar,verified:t.verified,follower_count:t.follower_count,following_count:t.following_count,video_count:t.video_count}),C("dm")},children:s("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:j(t.avatar)})}),s("div",{className:"user",children:[s("div",{className:"name",children:[t.username,t.verified&&e(me,{})]}),e("div",{className:"username",children:t.name}),s("div",{className:"stats",children:[X(t.follower_count)," ",o("APPS.TIKTOK.FOLLOWERS").toLowerCase()," ",X(t.video_count)??"0"," ",o("APPS.TIKTOK.VIDEOS").toLowerCase()]})]})]})})};function Ye({className:t}){return s("svg",{className:t,width:"43",height:"43",viewBox:"0 0 43 43",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s("g",{filter:"url(#filter0_d_4_1160)",children:[e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.8242 33.4976C21.7164 33.4992 21.6083 33.5 21.5 33.5C11.835 33.5 4 27.0081 4 19C4 10.9919 11.835 4.5 21.5 4.5C31.165 4.5 39 10.9919 39 19C39 21.0253 38.4989 22.9536 37.5938 24.7044C36.3794 27.1797 34.5051 29.3888 32.472 31.2945C29.3743 34.1981 25.7901 36.39 23.2378 37.6253C22.5627 37.9521 21.8242 37.4404 21.8242 36.7278V33.4976ZM15.5 19.75C15.5 21.1307 14.3807 22.25 13 22.25C11.6193 22.25 10.5 21.1307 10.5 19.75C10.5 18.3693 11.6193 17.25 13 17.25C14.3807 17.25 15.5 18.3693 15.5 19.75ZM21.5 22.25C22.8807 22.25 24 21.1307 24 19.75C24 18.3693 22.8807 17.25 21.5 17.25C20.1193 17.25 19 18.3693 19 19.75C19 21.1307 20.1193 22.25 21.5 22.25ZM32.5 19.75C32.5 21.1307 31.3807 22.25 30 22.25C28.6193 22.25 27.5 21.1307 27.5 19.75C27.5 18.3693 28.6193 17.25 30 17.25C31.3807 17.25 32.5 18.3693 32.5 19.75Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.5 33.5C31.165 33.5 39 27.0081 39 19C39 10.9919 31.165 4.5 21.5 4.5C11.835 4.5 4 10.9919 4 19C4 27.0081 11.835 33.5 21.5 33.5ZM13 22.25C14.3807 22.25 15.5 21.1307 15.5 19.75C15.5 18.3693 14.3807 17.25 13 17.25C11.6193 17.25 10.5 18.3693 10.5 19.75C10.5 21.1307 11.6193 22.25 13 22.25ZM24 19.75C24 21.1307 22.8807 22.25 21.5 22.25C20.1193 22.25 19 21.1307 19 19.75C19 18.3693 20.1193 17.25 21.5 17.25C22.8807 17.25 24 18.3693 24 19.75ZM30 22.25C31.3807 22.25 32.5 21.1307 32.5 19.75C32.5 18.3693 31.3807 17.25 30 17.25C28.6193 17.25 27.5 18.3693 27.5 19.75C27.5 21.1307 28.6193 22.25 30 22.25Z",fill:"currentColor"})]}),e("defs",{children:s("filter",{id:"filter0_d_4_1160",x:"0",y:"0.83",width:"43",height:"41.2262",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1160"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1160",result:"shape"})]})})]})}function ke({className:t}){return s("svg",{className:t,viewBox:"0 0 44 41",xmlns:"http://www.w3.org/2000/svg",children:[s("g",{filter:"url(#filter0_d_4_1165)",children:[e("path",{d:"M20.0611 35.818C21.0718 36.5395 22.4282 36.5395 23.4389 35.818C28.4905 32.2118 33.3281 28.063 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C10.1719 28.063 15.0095 32.2118 20.0611 35.818Z",fill:"currentColor"}),e("path",{d:"M20.0611 31.5C21.0718 32.2216 22.4282 32.2216 23.4389 31.5C29 28.5 31 27.5 36.6744 22.7538C38.3509 20.0939 39.0537 17.9429 39.3301 16.184C39.4416 15.5647 39.5 14.9257 39.5 14.2725C39.5 8.59918 35.097 4 29.6655 4C26.4197 4 23.5411 5.64254 21.75 8.17528C19.9589 5.64254 17.0803 4 13.8345 4C8.40304 4 4 8.59918 4 14.2725C4 14.9257 4.05836 15.5647 4.16994 16.184C4.44634 17.9429 5.14906 20.0939 6.82555 22.7538C13 27.5 15 28.5 20.0611 31.5Z",fill:"currentColor"})]}),e("defs",{children:s("filter",{id:"filter0_d_4_1165",x:"0",y:"0.33",width:"43.5",height:"40.3591",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1165"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1165",result:"shape"})]})})]})}function Lt(){const{View:t}=i.useContext(B),[d,h]=t,[P,w]=i.useState([]),[C,u]=i.useState(0),[v,l]=i.useState(0),[r,n]=i.useState(!1),[a,c]=i.useState(!1);i.useEffect(()=>{_("TikTok",{action:"getUnreadMessages"},{success:!0,unread:1}).then(L=>{if(!L.success)return T("warning","Failed to get unread messages: "+L.error);u(L==null?void 0:L.unread)}),_("TikTok",{action:"getNotifications",page:0},{success:!0,data:Z.Notifications}).then(L=>{if(!L.success)return T("warning","Failed to get notifications: "+L.error);w(L.data)})},[]);const K=()=>{if(a||r)return;let L=document.querySelector("#last");if(!L)return;!he(L)&&(n(!0),_("TikTok",{action:"getNotifications",page:v+1},null).then(I=>{var N;if(!(I!=null&&I.success))return T("warning","Failed to get notifications: "+I.error);if(!(I!=null&&I.data))return T("warning","Failed to get notifications: (NO DATA)"+(I==null?void 0:I.error));I&&((N=I==null?void 0:I.data)==null?void 0:N.length)>0?(w([...P,...I.data]),n(!1)):c(!0)}),l(I=>I+1))};return s("div",{className:"inbox-container",children:[s("div",{className:"inbox-header",children:[e("span",{}),e("div",{className:"title",children:o("APPS.TIKTOK.ALL_ACTIVITY")}),s("div",{className:"messages",onClick:()=>h("messages"),children:[e(Me,{}),C>0&&e("div",{className:"notifications",children:C})]})]}),s("div",{className:"inbox-body",onScroll:K,children:[P.length===0&&s("div",{className:"no-notifications",children:[e(xe,{}),e("div",{className:"title",children:o("APPS.TIKTOK.NO_NOTIFICATIONS")}),e("div",{className:"content",children:o("APPS.TIKTOK.NO_NOTIFICATIONS_SUBTITLE")})]}),P.map((L,b)=>e(_t,{data:L,last:P.length-1===b},b))]})]})}const _t=({data:t,last:d})=>{const{Func:h,GoBack:P}=i.useContext(B),[w,C]=P,[u,v]=i.useState(t.isFollowing),l=a=>{_("TikTok",{action:"toggleFollow",data:{username:t.username,follow:a}},{success:!0}).then(c=>{if(!c||!(c!=null&&c.success))return T("warning","Failed to toggle follow");if(c.error)return T("error",c.error);v(a)})};let r;switch(t.type){case"follow":r=o("APPS.TIKTOK.STARTED_FOLLOWING");break;case"like":r=o("APPS.TIKTOK.LIKED_VIDEO");break;case"like_comment":r=o("APPS.TIKTOK.LIKED_COMMENT");break;case"save":r=o("APPS.TIKTOK.SAVED_VIDEO");break;case"comment":r=o("APPS.TIKTOK.COMMENTED").format({comment:t.commentText});break;case"reply":r=o("APPS.TIKTOK.REPLIED").format({comment:t.commentText});break}const n=()=>{C({view:"inbox"}),h.fetchAndSetProfile(t.username)};return s("div",{className:de("notification",t.type),id:d?"last":"",children:[s("div",{className:"user",children:[s("div",{className:"avatar",onClick:n,children:[e("img",{src:j(t.avatar)}),(t.type==="like"||t.type==="comment"||t.type==="reply")&&e("div",{className:"type","data-color":t.type==="like"?"red":"blue",children:t.type==="like"?e(ke,{}):e(Ye,{})})]}),s("div",{className:"info",children:[s("div",{className:"username",onClick:n,children:[t.name,t.verified&&e(me,{})]}),s("div",{className:"notification-content",children:[r,e("div",{className:"timestamp",children:Ce(t.timestamp)})]}),(t.type==="reply"||t.type==="like_comment")&&s("div",{className:"original-text",children:[e("div",{className:"border"}),t.type==="like_comment"?t.commentText:t.originalText]})]})]}),t.type==="follow"?e("div",{className:de("button",u?"following":"follow"),onClick:a=>{a.stopPropagation(),u?$.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>l(!1)}]}):l(!0)},children:u?o("APPS.TIKTOK.UNFOLLOW"):o("APPS.TIKTOK.FOLLOW")}):e("div",{className:"video-preview",onClick:()=>{t.videoId&&(C({view:"inbox"}),h.fetchAndSetVideo(t.videoId,{single:!0}))},children:e("video",{src:t.videoSrc,controls:!1,autoPlay:!1,muted:!0})})]})};function bt(){const{User:t,GoBack:d,View:h,Func:P,Dm:w,Profile:C}=i.useContext(B),[u,v]=t,[l,r]=h,[n]=w,[a,c]=d,[K,L]=C,[b,I]=i.useState([]),[N,U]=i.useState(n==null?void 0:n.id),M=i.useRef(null),[D,A]=i.useState(""),[O,f]=i.useState(0),[k,m]=i.useState(!1),[p,F]=i.useState(!1);i.useEffect(()=>(Oe.ReceiveAppNotifications.set(!1),()=>{Oe.ReceiveAppNotifications.set(!0)}),[]),i.useEffect(()=>{N&&_("TikTok",{action:"getMessages",page:0,id:N},{success:!0,messages:Z.Messages.find(g=>g.id===N).messages}).then(g=>{if(!(g!=null&&g.success))return T("warning","An error occured while fetching messages. "+(g==null?void 0:g.error));if(!(g!=null&&g.messages))return T("warning","An error occured while fetching messages. (No messages)");I(g.messages.reverse())})},[N]),ce("tiktok:receivedMessage",g=>{n.username===g.sender&&I([...b,{...g,timestamp:new Date().getTime()}])});const y=()=>{if(D.trim().length===0)return T("warning","You can't send an empty message");_("TikTok",{action:"sendMessage",data:{id:N,username:n.username,content:D}},{success:!0,id:"3",channelId:Z.Messages.find(g=>g.id===N).id}).then(g=>{if(!(g!=null&&g.success))return T("warning","An error occured while sending message. "+(g==null?void 0:g.error));T("info",`Message sent to ${n.username}, id: ${g.id}, channelId: ${g==null?void 0:g.channelId}`),g!=null&&g.channelId&&!N&&U(g.channelId),M.current.value="",I([...b,{id:g.id,sender:u.username,recipient:n.username,content:D,timestamp:new Date().getTime()}]),A("");let q=document.querySelector(".dm-body");q.scrollTop=q.scrollHeight})},G=()=>{if(k||p)return;let g=document.querySelector("#last");if(!g)return;!he(g)&&(F(!0),_("Instagram",{action:"getMessages",page:O+1,username:n.username},null).then(z=>{z&&z.length>0?(I([...z.reverse(),...b]),F(!1)):m(!0)}),f(z=>z+1))},H=g=>{if(g)return/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/.test(g)},ne=g=>{P.fetchAndSetVideo(g,{single:!0}),c({view:"dm"})};return s(se.div,{...Ve,className:"dm-container",children:[s("div",{className:"dm-header",children:[e(ve,{onClick:()=>{a!=null&&a.view?(a.data&&a.data.identifier==="profile"&&L(a.data.data),r(a.view),c(null)):r("messages")},className:"chevron"}),s("div",{className:"profile",onClick:g=>{g.stopPropagation(),c({view:"dm",data:{identifier:"dm",data:n}}),P.fetchAndSetProfile(n.username)},children:[e("div",{className:"avatar",children:e("img",{src:j(n.avatar)})}),s("div",{className:"username",children:[n.name??n.username,n.verified&&e(me,{})]})]})]}),e("div",{className:"dm-body-container",onScroll:G,children:s("div",{className:"dm-body",children:[s("div",{className:"messages-hero","data-nomessages":b.length===0,children:[e("img",{className:"avatar",src:j(n.avatar)}),e("div",{className:"name",children:n.name}),s("div",{className:"secondary",children:[s("div",{className:"username",children:["@",n.username]}),s("div",{className:"stats",children:[s("div",{className:"following",children:[X(n.following_count)," ",o("APPS.TIKTOK.FOLLOWING").toLowerCase()]}),s("div",{className:"followers",children:[X(n.follower_count)," ",o("APPS.TIKTOK.FOLLOWERS").toLowerCase()]})]})]})]}),b.map((g,q)=>{var Q;let z,V=q===0,x=g.sender===u.username?"self":"other",J=((Q=b[q+1])==null?void 0:Q.sender)===u.username?"self":"other";return b[q+1]?z=Math.abs(g.timestamp-b[q+1].timestamp)/36e5:J=void 0,g.content&&H(g.content)&&(g.video=g.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[1],g.videoId=g.content.match(/<!SHARED-VIDEO-URL="(.*)"ID="(.*)"!>/)[2]),s("div",{className:`message ${x}`,id:V?"last":"",children:[x=="other"?s("div",{className:"message-with-pfp",children:[e("div",{className:`profile-picture ${x!==J?"show":"hide"}`,onClick:oe=>{oe.stopPropagation(),c({view:"dm",data:{identifier:"dm",data:n}}),P.fetchAndSetProfile(n.username)},children:e("img",{src:j(n.avatar)})}),e("div",{className:"message-content",children:g.video?s("div",{className:"shared-video",onClick:()=>ne(g.videoId),children:[e("video",{src:g.video,autoPlay:!1,controls:!1}),e(we,{})]}):e("div",{className:"content",children:Ee(g.content)})})]}):e(te,{children:g.video?s("div",{className:"shared-video",onClick:()=>ne(g.videoId),children:[e("video",{src:g.video,autoPlay:!1,controls:!1}),e(we,{})]}):e("div",{className:"content",children:Ee(g.content)})}),b[q+1]&&z>6?e("div",{className:"date",children:Ne(g.timestamp)}):x!==J&&e("div",{className:"date",children:Ne(g.timestamp)})]},q)})]})}),e("div",{className:"dm-footer",children:s("div",{className:"input",children:[e(ue,{type:"text",placeholder:o("APPS.DARKCHAT.INPUT_PLACEHOLDER"),ref:M,onChange:g=>A(g.target.value),onKeyDown:g=>{g.key==="Enter"&&y()}}),e("div",{className:"buttons",children:D.trim().length>0&&e("div",{className:"send",onClick:y,children:e(Xe,{})})})]})})]})}function Ut(){return s("svg",{viewBox:"0 0 23 23",xmlns:"http://www.w3.org/2000/svg",children:[e("path",{d:"M7.56201 11C8.39038 11 9.06201 10.1045 9.06201 9C9.06201 7.89551 8.39038 7 7.56201 7C6.73364 7 6.06201 7.89551 6.06201 9C6.06201 10.1045 6.73364 11 7.56201 11Z",fill:"currentColor"}),e("path",{d:"M16.062 9C16.062 10.1045 15.3904 11 14.562 11C13.7336 11 13.062 10.1045 13.062 9C13.062 7.89551 13.7336 7 14.562 7C15.3904 7 16.062 7.89551 16.062 9Z",fill:"currentColor"}),e("path",{d:"M11.062 15.7891C12.562 15.7891 14.062 14.7373 14.062 13.6328C14.062 12.5283 12.062 12.5 11.062 12.5C10.062 12.5 8.06201 12.5283 8.06201 13.6328C8.06201 14.7373 9.56201 15.7891 11.062 15.7891Z",fill:"currentColor"}),e("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.062 11.5C22.062 17.5752 17.1372 22.5 11.062 22.5C4.98682 22.5 0.0620117 17.5752 0.0620117 11.5C0.0620117 5.4248 4.98682 0.5 11.062 0.5C17.1372 0.5 22.062 5.4248 22.062 11.5ZM20.062 11.5C20.062 16.4705 16.0325 20.5 11.062 20.5C6.09155 20.5 2.06201 16.4705 2.06201 11.5C2.06201 6.52954 6.09155 2.5 11.062 2.5C16.0325 2.5 20.062 6.52954 20.062 11.5Z",fill:"currentColor"})]})}function Dt({id:t,commentCount:d,username:h,close:P}){const{User:w}=i.useContext(B),[C]=w,[u,v]=i.useState([]),[l,r]=i.useState(""),[n,a]=i.useState(null),[c,K]=i.useState(0),[L,b]=i.useState(!1),[I,N]=i.useState(!1),U=i.useRef(null),M=i.useRef(null);i.useEffect(()=>{var O;_("TikTok",{action:"getComments",page:0,data:{id:t,creator:h}},{success:!0,comments:(O=Z.Videos.find(f=>f.id===t))==null?void 0:O.commentsData}).then(f=>{if(!(f!=null&&f.success))return T("warning",f.error);f.comments.length<15&&b(!0),v(f.comments)})},[]);const D=()=>{if(l.trim().length===0)return T("warning","Comment is empty");let O=n!=null&&n.isReplyToReply?`@${n.name} ${l}`:l;_("TikTok",{action:"postComment",data:{id:t,comment:O,replyTo:n==null?void 0:n.id}},{success:!0,id:Math.floor(Math.random()*100)}).then(f=>{if(!(f!=null&&f.success))return T("warning",f.error);v(n?k=>k.map(m=>m.id==n.id?{...m,reply_count:m!=null&&m.reply_count?m.reply_count+1:1,replies:[{id:f.id,username:C.username,avatar:C.avatar,comment:O,timestamp:new Date().getTime(),likes:0,liked:!1,verified:C.verified},...(m==null?void 0:m.replies)||[]]}:m):k=>[{id:f.id,username:C.username,avatar:C.avatar,comment:O,timestamp:new Date().getTime(),likes:0,liked:!1,verified:C.verified},...k]),r(""),M.current.style.height="auto",a(null)})},A=()=>{if(L||I)return T("warning","Already fetched everything or is fetching");let O=document.querySelector("#last");if(!O)return T("warning","No last element");!he(O)&&(N(!0),_("TikTok",{action:"getComments",page:c+1,data:{id:t,creator:h}},null).then(k=>{if(!(k!=null&&k.success))return T("warning",k.error);k&&(k==null?void 0:k.comments.length)>0?(k.comments.length<15&&b(!0),v(m=>[...m,...k.comments]),N(!1)):(T("info","Fetched everything"),N(!1),b(!0))}),K(k=>k+1))};return i.useEffect(()=>{const O=f=>{const k=U.current;k.scrollTo({top:k.scrollTop+f.deltaY,behavior:"smooth"})};return U.current&&U.current.addEventListener("wheel",O),()=>{U.current&&U.current.removeEventListener("wheel",O)}},[U]),e("div",{className:"comments-container",onClick:()=>P(),children:s(se.div,{...Pe,className:"comments-wrapper",onClick:O=>O.stopPropagation(),children:[s("div",{className:"comments-header",children:[e("div",{}),e("div",{className:"title",children:o("APPS.TIKTOK.COMMENTS_TITLE").format({count:d})}),e("div",{className:"close",children:e(Ae,{onClick:P})})]}),e("div",{className:"comments-body",ref:U,onScroll:A,children:u.map((O,f)=>e(je,{comment:O,videoId:t,username:h,remove:()=>v(k=>k.filter(m=>m.id!=O.id)),setReplyTo:a,last:f==u.length-1},O.id))}),s("div",{className:"comments-footer",children:[e("img",{src:j(C.avatar)}),s("div",{className:"input",children:[e(ue,{maxLength:300,ref:M,value:l,onChange:O=>{r(O.target.value);let f=O.target.scrollHeight;O.target.style.height=f+"px"},onKeyDown:O=>{O.key=="Enter"&&D(),O.key==" "&&r(f=>f+" ")},placeholder:n?o("APPS.TIKTOK.REPLY_TO").format({name:n.name}):o("APPS.TIKTOK.ADD_COMMENT")}),e("span",{onClick:()=>{$.Emoji.set({onSelect:O=>r(f=>f+O.emoji)})},children:e(Ut,{})}),l.trim().length>0&&e("span",{children:e(Re,{onClick:D})})]})]})]})})}const je=({videoId:t,username:d,comment:h,remove:P,setReplyTo:w,last:C})=>{var f,k,m;const{User:u}=i.useContext(B),[v,l]=u,[r,n]=i.useState(h),[a,c]=i.useState(r.likes),[K,L]=i.useState(r.liked===1),[b,I]=i.useState(r.creator_liked===1);i.useState(0),i.useState(!1),i.useState(!1);const[N,U]=i.useState(!1);i.useEffect(()=>{h&&n(h)},[h]);const M=()=>{_("TikTok",{action:"getComments",page:0,data:{id:t,replyTo:r.id,creator:d}},null).then(p=>{if(!(p!=null&&p.success))return T("warning",p.error);n(F=>({...F,replies:[...(F==null?void 0:F.replies)??[],...p.comments.filter(y=>F!=null&&F.replies?!F.replies.some(G=>G.id===y.id):!0)]})),U(!0)})},D=()=>{_("TikTok",{action:"toggleLikeComment",id:r.id,toggle:!K},{success:!0}).then(p=>{if(!(p!=null&&p.success))return T("warning",p.error);v.username===d&&I(F=>!F),L(F=>!F),n(F=>({...F,liked:!K}))})};ce("tiktok:updateCommentLikes",p=>{p.id===r.id&&c(F=>p.method==="add"?F+1:F-1)});let A=r.username!==v.username||d!==r.username||v.isAdmin;const O=Qe(p=>{if(p.stopPropagation(),p.preventDefault(),!A)return T("warning","You cannot click to this comment!");let F=[(v.isAdmin||v.username===r.username)&&{title:o("APPS.TIKTOK.DELETE_COMMENT"),color:"red",cb:()=>{_("TikTok",{action:"deleteComment",id:r.id,videoId:t}).then(y=>{if(!(y!=null&&y.success))return T("warning",y.error);P()})}}];$.ContextMenu.set({buttons:F})});return s("div",{className:"item",id:C?"last":"","data-clickable":A,"data-id":r.id,children:[s("div",{className:"comment-info",...O,children:[e("div",{className:"avatar",children:e("img",{src:j(r.avatar)})}),s("div",{className:"comment-data",children:[s("div",{className:"username",children:[r.username,r.verified&&e(me,{}),r.username===d&&e("div",{className:"creator-badge",children:o("APPS.TIKTOK.CREATOR")})]}),e("div",{className:"comment",children:r.comment}),s("div",{className:"actions",children:[e("div",{className:"timestamp",children:Ce(r.timestamp)}),e("div",{className:"reply",onClick:()=>{w(()=>({id:r.replyTo??r.id,name:r.username,isReplyToReply:r.replyTo!==void 0}))},children:o("APPS.TIKTOK.REPLY")})]}),b&&e("div",{className:"creator-liked",children:o("APPS.TIKTOK.LIKED_BY_CREATOR")})]})]}),(r.reply_count>0||r.replies)&&s("div",{className:"replies",children:[(f=r.replies)==null?void 0:f.map(p=>e(je,{videoId:t,username:d,comment:{...p,replyTo:r.id},remove:()=>{n(F=>{var y;return{...F,reply_count:F.reply_count-1,replies:(y=F.replies)==null?void 0:y.filter(G=>G.id!==p.id)}})},setReplyTo:w})),!N&&((k=r.replies)==null?void 0:k.length)!==r.reply_count&&s("div",{className:"view-replies",onClick:M,children:[o("APPS.TIKTOK.VIEW_REPLIES")," ",s("b",{children:["(",r!=null&&r.replies?r.reply_count-(((m=r.replies)==null?void 0:m.length)??0):r.reply_count,")"]})," ",e(Ge,{})]})]}),s("div",{className:"likes","data-active":K,onClick:D,children:[K?e(ke,{}):e(ze,{}),X(a)]})]})};function Ft({className:t}){return s("svg",{className:t,width:"43",height:"36",viewBox:"0 0 43 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s("g",{filter:"url(#filter0_d_4_1154)",children:[e("path",{d:"M37.9988 19.0845C38.4285 18.6965 38.4399 18.0257 38.0236 17.6233L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 9.55921 26.2993 11.979 25.3314C13.3564 24.7805 15.6523 24.5297 17.9033 24.4891C20.0514 24.4504 22.0549 24.6041 23.0432 24.822V30.3392C23.0432 31.2058 24.0703 31.6622 24.7134 31.0814L37.9988 19.0845Z",fill:"currentColor"}),e("path",{d:"M33.906 17.6574C34.8657 16.5418 33.906 14.9506 33.906 14.9506L32.25 12.0469L24.7382 4.78295C24.1035 4.16949 23.0432 4.61928 23.0432 5.50199V10.8621C18.0772 10.7853 14.3463 12.0842 11.5737 14.0746C8.75779 16.0962 6.9636 18.807 5.858 21.4345C4.75341 24.0595 4.32774 26.6203 4.25995 28.3761C4.22652 29.242 4.27816 29.9566 4.40223 30.3933C4.43394 30.5048 4.47678 30.622 4.53837 30.7255C4.59258 30.8167 4.70727 30.9754 4.91565 31.0417C5.16639 31.1214 5.37921 31.0191 5.50256 30.9132C5.61389 30.8176 5.6887 30.6943 5.74047 30.5908L5.74705 30.5777L5.75234 30.5653L5.75284 30.5641L5.75411 30.5613L5.76432 30.5391C5.77418 30.518 5.79023 30.4845 5.81294 30.44C5.85837 30.3509 5.93042 30.2173 6.03287 30.049C6.23783 29.7123 6.56409 29.237 7.04199 28.6994C7.99659 27.6255 13.2932 23.8672 16.2932 22.3672C18.7932 20.8672 23.0432 19.8672 23.0432 19.8672V25.8672C23.0432 26.7337 24.0703 27.1901 24.7134 26.6094L33.906 17.6574Z",fill:"currentColor"})]}),e("defs",{children:s("filter",{id:"filter0_d_4_1154",x:"0.25",y:"0.83",width:"42.0786",height:"34.8412",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[e("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),e("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),e("feOffset",{dy:"0.33"}),e("feGaussianBlur",{stdDeviation:"2"}),e("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),e("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_4_1154"}),e("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow_4_1154",result:"shape"})]})})]})}function Ke({data:t,active:d,preview:h}){var oe,Y,ae;const{User:P,Func:w,ShareComponent:C,GoBack:u}=i.useContext(B),v=fe(re.Settings),[l]=P,[r,n]=C,[a,c]=i.useState(t==null?void 0:t.liked),[K,L]=i.useState(t==null?void 0:t.saved),[b,I]=i.useState(t==null?void 0:t.viewed),[N,U]=i.useState(t==null?void 0:t.likes),[M,D]=i.useState(t==null?void 0:t.saves),[A,O]=i.useState(t==null?void 0:t.comments),[f,k]=i.useState(!1),m=i.useRef(null),p=i.useRef(null),F=i.useRef(0),[y,G]=i.useState(!1),[H,ne]=i.useState(!1),g=fe(He),q=fe(Oe.LockScreenVisible);i.useEffect(()=>{var S,R;return d&&((S=t.music)!=null&&S.path&&V(),(R=t.metadata)!=null&&R.tts&&z()),()=>{m!=null&&m.current&&m.current.pause(),p!=null&&p.current&&p.current.pause(),b||_("TikTok",{action:"setViewed",id:t.id},!0).then(()=>{I(!0)})}},[d]),i.useEffect(()=>{var S,R,ee;g!=null&&g.visible?(ne(!0),m!=null&&m.current&&m.current.pause(),p!=null&&p.current&&p.current.pause()):((ee=(R=(S=Se)==null?void 0:S.value)==null?void 0:R.active)==null?void 0:ee.name)==="TikTok"&&(ne(!1),m!=null&&m.current&&m.current.play(),p!=null&&p.current&&p.current.play())},[g==null?void 0:g.visible]),i.useEffect(()=>{const S=document.querySelector(".video video");q?(m!=null&&m.current&&m.current.pause(),p!=null&&p.current&&p.current.pause(),S==null||S.pause()):(m!=null&&m.current&&m.current.play(),p!=null&&p.current&&p.current.play(),S==null||S.play())},[q]);const z=()=>{var R;if(!t.metadata.ttsUrl)return;m!=null&&m.current&&(m.current.pause(),m.current=null);const S=new Audio;S.src=t.metadata.ttsUrl,S.volume=(((R=v==null?void 0:v.sound)==null?void 0:R.volume)??.5)/2,S.play(),m.current=S},V=()=>{var R,ee;const S=new Audio;p!=null&&p.current&&(p.current.pause(),p.current=null),S.src=(R=t.music.path)!=null&&R.includes("http")?t.music.path:`./assets/sound/songs/${t.music.path}`,S.volume=t.music.volume*(((ee=v==null?void 0:v.sound)==null?void 0:ee.volume)??1),S.play(),p.current=S};i.useEffect(()=>{var S,R,ee;(S=v==null?void 0:v.sound)!=null&&S.volume&&(p!=null&&p.current&&(p.current.volume=t.music.volume*(((R=v==null?void 0:v.sound)==null?void 0:R.volume)??1)),m!=null&&m.current&&(m.current.volume=(((ee=v==null?void 0:v.sound)==null?void 0:ee.volume)??.5)/2))},[(oe=v==null?void 0:v.sound)==null?void 0:oe.volume]);const x=()=>{h||_("TikTok",{action:"toggleLike",id:t.id,toggle:!a},{success:!0}).then(S=>{if(!S.success)return T("warning",S.error);c(!a)})},J=()=>{h||-_("TikTok",{action:"toggleSave",id:t.id,toggle:!K},{success:!0}).then(S=>{if(!S.success)return T("warning",S.error);L(!K)})};ce("tiktok:updateLikes",S=>{if(S&&S.id===t.id)return U(R=>R+(S.method==="add"?1:-1))}),ce("tiktok:updateSaves",S=>{if(S&&S.id===t.id)return D(R=>R+(S.method==="add"?1:-1))}),ce("tiktok:updateComments",S=>{if(S&&S.id===t.id)return O(R=>(S.count=S.count??1,R+(S.method==="add"?S.count:-S.count)))});const Q=S=>{if(S.detail===1)return ne(!H);if(S.detail===2){if(!t.id)return;a||(x(),G(!0),setTimeout(()=>{G(!1)},1e3))}};return i.useEffect(()=>{const S=document.querySelector(".video video");S&&(H?(S.pause(),m!=null&&m.current&&m.current.pause(),p!=null&&p.current&&p.current.pause(),T("info","paused everything")):(S.play(),m!=null&&m.current&&m.current.play(),p!=null&&p.current&&p.current.play(),T("info","playing everything")))},[H]),s(te,{children:[e(ge,{children:f&&!h&&e(Dt,{id:t.id,username:t.username,commentCount:A,close:()=>k(!1)})}),s("div",{className:"video","data-active":d,onClick:Q,children:[y&&e("div",{className:"popup-heart","data-visible":y,children:e(Be,{})}),H&&e("div",{className:"paused",children:e(we,{})}),e("video",{src:t.src,autoPlay:!0,loop:!0,muted:!d,onTimeUpdate:S=>{var R,ee;d&&(S.target.currentTime<F.current&&((R=t==null?void 0:t.music)!=null&&R.path&&V(),(ee=t==null?void 0:t.metadata)!=null&&ee.ttsUrl&&(m.current.currentTime=0,m.current.play())),F.current=S.target.currentTime)}}),s("div",{className:"video-info",children:[s("div",{className:"user",children:[s("div",{className:"username",onClick:()=>{if(!h)return w.fetchAndSetProfile(t.username)},children:[t.name??`@${t.username}`,t.verified&&e(me,{})]}),s("span",{children:[" â€¢ ",Ce(t.timestamp)]})]}),e("div",{className:"caption",children:t.caption}),((Y=t==null?void 0:t.music)==null?void 0:Y.title)&&s("div",{className:"song",children:[e(et,{})," ",t.music.artist," - ",t.music.title]})]}),s("div",{className:"video-actions",children:[e("img",{className:"profile",src:j(t.avatar),onClick:S=>{if(S.stopPropagation(),!h)return w.fetchAndSetProfile(t.username)}}),s("div",{className:"action","data-active":a,onClick:S=>{S.stopPropagation(),x()},children:[e(ke,{className:"like"}),X(N)]}),s("div",{className:"action",onClick:S=>{S.stopPropagation(),k(!0)},children:[e(Ye,{className:"comment"}),X(A)]}),s("div",{className:"action",onClick:S=>{S.stopPropagation(),J()},"data-active":K,children:[e(We,{className:"save"}),X(M)]}),e("div",{className:"action",onClick:S=>{S.stopPropagation(),n({id:t.id,src:t.src,username:t.username,pinned:t.pinned})},children:(l==null?void 0:l.username)===t.username?e(tt,{className:"manage"}):s(te,{children:[e(Ft,{className:"share"}),o("APPS.TIKTOK.SHARE")]})}),e("div",{className:"song",children:e("img",{src:((ae=t==null?void 0:t.music)==null?void 0:ae.cover)??"./assets/img/icons/music/unknown.png"})})]})]})]})}function Ue(){var z;const{View:t,Profile:d,FeedData:h,Func:P,GoBack:w}=i.useContext(B),C=fe(re.Settings),[u,v]=t,[l,r]=h,[n,a]=w,[c,K]=i.useState(0),[L,b]=i.useState(!1),[I,N]=i.useState(!1),[U,M]=i.useState("recent"),[D,A]=i.useState([]),[O,f]=i.useState(0),k=fe(Se),m=i.useRef(null);i.useEffect(()=>{var V;if(u!=="feed"){p.current=!0;return}return K(0),N(!1),b(!1),A([]),(V=l==null?void 0:l.args)!=null&&V.single?(A([l.video]),f(0),y.current=0):_("TikTok",{action:"getVideos",page:0,data:{full:!0,type:U,...l==null?void 0:l.args}},Z.Videos).then(x=>{if(!x)return T("warning","No videos found");x.length<5&&N(!0),l&&(l!=null&&l.video)&&x.unshift(l.video),f(0),y.current=0,A(x)}),()=>{r(null)}},[u]),i.useEffect(()=>{if(nt("TikTok")&&u==="feed")return setTimeout(()=>{re.Styles.TextColor.set("#ffffff")},100),()=>{re.Styles.TextColor.set(C.display.theme==="dark"?"#ffffff":"#000000"),re.SoundManager.reset()}},[u,k==null?void 0:k.active]);const p=i.useRef(!0);i.useEffect(()=>{if(!l){if(p.current){p.current=!1;return}A([]),_("TikTok",{action:"getVideos",page:0,data:{full:!0,type:U}},Z.Videos).then(V=>{if(!V)return T("warning","No videos found");V.length<5&&N(!0),A(V),y.current=0,f(0)})}},[U,l]);const F=i.useRef(!1),y=i.useRef(0);i.useEffect(()=>{y.current=0,f(0),K(0),N(!1),b(!1)},[U]),i.useEffect(()=>{if(D.length===0)return T("info","No videos found");if(D.length===1||D.length-2===O){if(T("info","fetching more videos: "+JSON.stringify(l)),l!=null&&l.single)return;if(L||I)return T("info","Already fetching or fetched everything");b(!0),_("TikTok",{action:"getVideos",page:c+1,data:{full:!0,type:U,...l==null?void 0:l.args}},null).then(V=>{V&&V.length>0?(V.length<5&&N(!0),A(x=>[...x,...V]),b(!1)):(T("info","Fetched everything"),b(!1),N(!0)),K(x=>x+1)})}},[O]),i.useEffect(()=>{if(!D||D.length===0)return;const V=()=>{if(!F.current)return requestAnimationFrame(V);F.current=!1;const Y=m.current,S=document.querySelector(".video").getBoundingClientRect().height,R=y.current*S;T("info",`Target scroll position: ${R}, current scroll position: ${Y.scrollTop}, snapIndex: ${y.current}`),Y.scrollTo({top:R,behavior:"smooth"}),f(y.current),requestAnimationFrame(V)};requestAnimationFrame(V);const x=Y=>{var ae,S;Y.preventDefault(),!((S=(ae=He)==null?void 0:ae.value)!=null&&S.visible)&&G(Y)},J=["ArrowUp","ArrowDown","Space"],Q=Y=>{(J.includes(Y.key)||J.includes(Y.code))&&(document.querySelector(".tiktok-content")||Y.preventDefault()),(Y.key==="ArrowUp"||Y.key==="ArrowDown")&&H(Y.key==="ArrowUp"?-1:1)},oe=m.current;return oe.addEventListener("wheel",x,{passive:!1}),window.addEventListener("keydown",Q),()=>{oe.removeEventListener("wheel",x),window.removeEventListener("keydown",Q)}},[D]);const G=V=>{if(V.preventDefault(),g())return;const J=V.deltaY<0?-1:1;H(J)},H=V=>{const J=D.length-1,Q=y.current+V;Q>=0&&Q<=J?(y.current=Q,F.current=!0,T("info","Scrolling to video: "+y.current)):Q<0?T("info","Top of the feed, trying to scroll up?"):T("info","Reached the bottom of the feed")},ne=V=>{V.button===1&&V.preventDefault()},g=()=>!!document.querySelector(".comments-container");let q=u==="feed";return e("div",{className:"tiktok-feed",style:{visibility:q?"visible":"hidden"},children:s(se.div,{className:"feed-wrapper",...$e("right",u),children:[!l&&e("div",{className:"feed-header",children:s("div",{className:"feed-header-content",children:[e("div",{className:de("item",U=="following"&&"active"),onClick:()=>M("following"),children:o("APPS.TIKTOK.FOLLOWING")}),e("div",{className:de("item",U=="recent"&&"active"),onClick:()=>M("recent"),children:o("APPS.TIKTOK.FOR_YOU")}),e("div",{className:"border","data-direction":U==="recent"?"right":"left"})]})}),U==="following"&&D.length===0&&e("div",{className:"no-following",children:o("APPS.TIKTOK.NO_FOLLOWING_TITLE")}),(((z=l==null?void 0:l.args)==null?void 0:z.username)||(n==null?void 0:n.view))&&e(ve,{className:"go-back",onClick:()=>{r(null),n!=null&&n.view&&!(n!=null&&n.ignoreFeed)?(v(n.view),a(null)):P.fetchAndSetProfile(l.args.username)}}),e("div",{className:"videos",ref:m,onMouseDown:ne,children:D==null?void 0:D.map((V,x)=>e(Ke,{data:V,active:O===D.indexOf(V)&&q},x))})]})})}function yt(){const{User:t,LoggedIn:d,View:h}=i.useContext(B),[P,w]=t,[C,u]=d,[v,l]=h,[r,n]=i.useState("login"),[a,c]=i.useState(null),[K,L]=i.useState(!0),b=()=>{let I=a==null?void 0:a.username.toLowerCase().replace(/\s/g,"");if(K)return T("warning","Button is disabled");if(!a)return T("warning","No form data");_("TikTok",{action:r,data:a}).then(N=>{var U,M,D,A,O;if(!N)return T("warning","Could not login, no response");if(N.success){let f={...N.data,username:((U=N.data)==null?void 0:U.username)??I,name:((M=N.data)==null?void 0:M.username)??(a==null?void 0:a.name),follower_count:((D=N.data)==null?void 0:D.follower_count)||0,following_count:((A=N.data)==null?void 0:A.following_count)||0,like_count:((O=N.data)==null?void 0:O.like_count)||0};w(f),u(!0),l("feed"),ie.APPS.TIKTOK.account.set(f)}else T("info",`Could not login, ${N.error}`)})};return i.useEffect(()=>{var I,N;a&&L(r==="login"?!a.username||!a.password:!a.name||!a.username&&((I=a.username)==null?void 0:I.length)<3||!a.password&&((N=a.password)==null?void 0:N.length)<3)},[a]),s("div",{className:"login-container",children:[s("div",{className:"login-header",children:[e("div",{className:"title",children:r==="login"?o("APPS.TIKTOK.LOGIN_TITLE"):o("APPS.TIKTOK.SIGNUP_TITLE")}),e("div",{className:"subtitle",children:r==="login"?o("APPS.TIKTOK.LOGIN_SUBTITLE"):o("APPS.TIKTOK.SIGNUP_SUBTITLE")})]}),s("div",{className:"login-body",children:[r==="signup"&&e(ue,{placeholder:o("APPS.TIKTOK.NAME"),onChange:I=>{I.target.value.length>30||c({...a,name:I.target.value})}}),e(ue,{placeholder:o("APPS.TIKTOK.USERNAME"),onChange:I=>{I.target.value.length>20||c({...a,username:I.target.value.toLowerCase()})}}),e(ue,{type:"password",placeholder:o("APPS.TIKTOK.PASSWORD"),onChange:I=>{I.target.value.length>50||c({...a,password:I.target.value})}}),e("div",{className:"login-button","data-disabled":K,onClick:b,children:r==="login"?o("APPS.TIKTOK.LOGIN"):o("APPS.TIKTOK.SIGNUP")})]}),e("div",{className:"login-footer",children:r==="login"?s(te,{children:[o("APPS.TIKTOK.NO_ACCOUNT")," ",e("span",{onClick:()=>n("signup"),children:o("APPS.TIKTOK.SIGNUP")})]}):s(te,{children:[o("APPS.TIKTOK.ALREADY_ACCOUNT")," ",e("span",{onClick:()=>n("login"),children:o("APPS.TIKTOK.LOGIN")})]})})]})}function Vt(){const{User:t,Profile:d,View:h,LoggedIn:P,UserPanel:w,Func:C,GoBack:u,Dm:v}=i.useContext(B),[l,r]=t,[n,a]=d,[c,K]=P,[L,b]=w,[I,N]=u,[U,M]=v,[D,A]=h,[O,f]=i.useState([]),[k,m]=i.useState(!1),[p,F]=i.useState("recent"),[y,G]=i.useState(0),[H,ne]=i.useState(!1),[g,q]=i.useState(!1),[z,V]=i.useState((n==null?void 0:n.follower_count)||0),[x,J]=i.useState((n==null?void 0:n.following_count)||0),Q=[{value:"recent",icon:e(it,{})},{value:"liked",icon:n!=null&&n.show_likes?e(Be,{}):e(st,{})},{value:"saved",hidden:(l==null?void 0:l.username)!==(n==null?void 0:n.username),icon:e(We,{})}],oe=[{label:o("APPS.TIKTOK.FOLLOWING"),name:"following",value:n==null?void 0:n.following_count},{label:o("APPS.TIKTOK.FOLLOWERS"),name:"followers",value:n==null?void 0:n.follower_count},{label:o("APPS.TIKTOK.LIKES"),value:n==null?void 0:n.like_count}];i.useEffect(()=>{if(n){if(G(0),V((n==null?void 0:n.follower_count)||0),J((n==null?void 0:n.following_count)||0),f([]),p==="liked"&&!(n!=null&&n.show_likes)&&l.username!==n.username)return f([]);_("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:p},page:0},Z.Videos.filter(E=>E.username===n.username)).then(E=>{if(!E)return T("warning","Failed to get videos");f(E)})}},[p,n==null?void 0:n.username]);const Y=()=>{if(g||H)return T("warning","Already fetched everything or is fetching");let E=document.querySelector("#last");if(!E)return T("warning","No last element");!he(E)&&(ne(!0),_("TikTok",{action:"getVideos",data:{full:!1,username:n.username,type:p},page:y+1},null).then(le=>{le&&le.length>0?(f(pe=>[...pe,...le]),ne(!1)):(T("info","Fetched everything"),ne(!1),q(!0))}),G(le=>le+1))},ae=E=>{_("TikTok",{action:"toggleFollow",data:{username:n.username,follow:E}},{success:!0}).then(W=>{if(!W||!(W!=null&&W.success))return T("warning","Failed to toggle follow");if(W.error)return T("error",W.error);T("info",`Toggling follow to ${E}`),a({...n,isFollowing:E})})};ce("tiktok:updateFollowers",E=>{if(!E||E.username!==n.username)return;let W=z+(E.method==="add"?1:-1);a({...n,follower_count:W}),V(W)}),ce("tiktok:updateFollowing",E=>{if(!E||E.username!==n.username)return;let W=x+(E.method==="add"?1:-1);a({...n,following_count:W}),J(W)});const S=()=>{l.username===n.username&&_("AccountSwitcher",{action:"getAccounts",app:"TikTok"}).then(E=>{var pe;if(!E)return T("info","No accounts found");let W=l.isAdmin,le=(pe=E==null?void 0:E.filter(Te=>Te!==l.username))==null?void 0:pe.map(Te=>({title:Te,cb:()=>{Te!==l.username&&_("AccountSwitcher",{action:"switch",app:"TikTok",account:Te}).then(()=>{_("TikTok",{action:"isLoggedIn"}).then(Ie=>{Ie?(ie.APPS.TIKTOK.account.set(Ie),r({...Ie,isAdmin:W}),A("feed"),K(!0)):ie.APPS.TIKTOK.account.set(null)})})}}));$.ContextMenu.set({buttons:[...le,{title:o("APPS.TIKTOK.ADD_ACCOUNT_TITLE"),cb:()=>{K(!1)}}]})})},R=E=>{r(E),a(E),m(!1)},ee=()=>{l.username!==n.username&&_("TikTok",{action:"getChannelId",username:n.username}).then(E=>{M({id:E.id,username:n.username,name:n.name,avatar:n.avatar,follower_count:n.follower_count,following_count:n.following_count,isFollowing:n.isFollowing}),N({view:"profile",data:{identifier:"profile",data:n}}),A("dm"),a(null)})};return n?s(te,{children:[e(ge,{children:k&&e(Mt,{close:E=>R(E)})}),s(se.div,{className:"profile-container",children:[s("div",{className:"profile-header",children:[n.username===l.username?e("span",{}):e("div",{children:e(ve,{className:"go-back",onClick:()=>{var E,W;if(I!=null&&I.view){if(I!=null&&I.data)switch((E=I==null?void 0:I.data)==null?void 0:E.identifier){case"dm":M((W=I==null?void 0:I.data)==null?void 0:W.data),A("dm");break;default:A("feed"),a(null)}else A(I==null?void 0:I.view);N(null)}else A("feed");a(null)}})}),s("div",{className:"name",onClick:S,children:[n.name,l.username===n.username&&e(Ge,{})]}),e("span",{})]}),s("div",{className:"profile-info",onScroll:Y,children:[e("div",{className:"avatar",children:e("img",{src:j(n.avatar)})}),s("div",{className:"username",children:["@",n.username,n.verified&&e(me,{})]}),e("div",{className:"stats",children:oe.map((E,W)=>{let le={followers:z,following:x};return s("div",{className:"item","data-cursor":E.name!==void 0,onClick:()=>{E.name&&b({value:E.name,username:n.username,following:x,followers:z})},children:[e("div",{className:"value",children:X(le[E.name]??n.like_count)}),e("div",{className:"label",children:E.label})]},W)})}),s("div",{className:"actions",children:[l.username===n.username?e("div",{className:"button big",onClick:()=>m(!0),children:o("APPS.TIKTOK.EDIT_PROFILE")}):e(te,{children:n.isFollowing?s(te,{children:[e("div",{className:de("button","big"),onClick:ee,children:o("APPS.TIKTOK.MESSAGE")}),e("div",{className:"button",onClick:()=>{$.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:n.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>ae(!1)}]})},children:e(ot,{})})]}):s(te,{children:[e("div",{className:"button follow",onClick:()=>ae(!0),children:o("APPS.TIKTOK.FOLLOW")}),e("div",{className:"button",onClick:ee,children:e(Me,{})})]})}),n.instagram&&e("div",{className:"button",onClick:()=>{Se.patch({active:{name:"Instagram",data:{username:n.instagram,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/instagram/icon.svg"})}),n.twitter&&e("div",{className:"button",onClick:()=>{Se.patch({active:{name:"Twitter",data:{username:n.twitter,view:"profile"}}})},children:e("img",{src:"./assets/img/icons/twitter/logo.png"})})]}),e("div",{className:"bio",children:n.bio}),s("div",{className:"profile-videos",children:[e("div",{className:"navbar",children:Q.filter(E=>!E.hidden).map(E=>e("div",{className:de("item",p===E.value&&"active"),onClick:()=>F(E.value),children:E.icon}))}),s("div",{className:"feed",children:[p==="liked"&&!(n!=null&&n.show_likes)&&l.username!==n.username&&s("div",{className:"private",children:[e("div",{className:"title",children:o("APPS.TIKTOK.LIKED_HIDDEN_TITLE")}),e("div",{className:"subtitle",children:o("APPS.TIKTOK.LIKED_HIDDEN_SUBTITLE").format({name:n.username})})]}),O.map((E,W)=>e(Rt,{data:E,last:W===O.length-1,onClick:()=>{N({...I,ignoreFeed:!0}),C.fetchAndSetVideo(E.id,{username:n.username,id:E.id,type:p})}}))]})]})]})]})]}):null}const Rt=({data:t,last:d,onClick:h})=>s("div",{className:"item",onClick:h,id:d?"last":"",children:[e("video",{src:t.src,loop:!0,onMouseEnter:P=>P.currentTarget.play(),onMouseLeave:P=>P.currentTarget.pause(),muted:!0}),t.pinned===1&&e("div",{className:"pinned",children:"Pinned"}),s("div",{className:"views",children:[e(ye,{}),X(t.views)]})]}),Mt=t=>{const{User:d,LoggedIn:h,View:P}=i.useContext(B),[w,C]=d,[u,v]=h,[l,r]=i.useState(null),n=["instagram","twitter"];i.useEffect(()=>{r({name:w.name,bio:w.bio,avatar:w.avatar,instagram:w.instagram,twitter:w.twitter,show_likes:w.show_likes})},[]);const a=()=>{_("TikTok",{action:"updateProfile",data:l},{success:!0}).then(c=>{if(!c)return T("warning","No response from server");if(c.success)ie.APPS.TIKTOK.account.set({...w,...l}),t.close({...w,...l});else switch(T("error",c.error),c.error){case"invalid_twitter":$.PopUp.set({title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:o("APPS.TWITTER.TITLE")}),description:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:o("APPS.TWITTER.TITLE".toLocaleLowerCase())}),buttons:[{title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]});break;case"invalid_instagram":$.PopUp.set({title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.TITLE").format({name:o("APPS.INSTAGRAM.TITLE")}),description:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.DESCRIPTION").format({name:o("APPS.INSTAGRAM.TITLE").toLocaleLowerCase()}),buttons:[{title:o("APPS.TIKTOK.INVALID_ACCOUNT_POPUP.OK")}]})}})};return s(se.div,{...Pe,className:"edit-profile-container",children:[s("div",{className:"edit-profile-header",children:[e("div",{children:e(ve,{onClick:a})}),e("div",{className:"title",children:o("APPS.TIKTOK.EDIT_PROFILE")}),e("span",{})]}),s("div",{className:"edit-profile-content",children:[s("div",{className:"avatar",children:[s("div",{className:"image",onClick:()=>$.Gallery.set({onSelect:c=>{r({...l,avatar:c.src})}}),children:[e("img",{src:j(l==null?void 0:l.avatar)}),e(at,{})]}),o("APPS.TIKTOK.CHANGE_PHOTO")]}),s("div",{className:"form",children:[s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.NAME")}),e(ue,{type:"text",defaultValue:l==null?void 0:l.name,onChange:c=>{c.target.value.length<=30&&r({...l,name:c.target.value})}})]}),s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.USERNAME")}),e(ue,{type:"text",disabled:!0,value:w.username})]}),s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.BIO")}),e(qe,{placeholder:o("APPS.TIKTOK.ADD_TO_YOUR_PROFILE"),defaultValue:l==null?void 0:l.bio,onChange:c=>{c.target.value.length<=150&&r({...l,bio:c.target.value})}})]}),e("div",{className:"break"}),n.map((c,K)=>s("div",{className:"item",children:[e("div",{className:"label",children:Le(c)}),e("div",{className:"value",onClick:()=>{l!=null&&l[c]?$.PopUp.set({title:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.TITLE").format({name:o(`APPS.${c.toUpperCase()}.TITLE`)}),description:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.DESCRIPTION").format({name:o(`APPS.${c.toUpperCase()}.TITLE`)}),buttons:[{title:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.CANCEL")},{title:o("APPS.TIKTOK.REMOVE_ACCOUNT_POPUP.PROCEED"),color:"red",cb:()=>{r({...l,[c]:null})}}]}):_("AccountSwitcher",{action:"getAccounts",app:Le(c)}).then(L=>{L||T("info","No accounts found");let b=(L==null?void 0:L.map(I=>({title:I,cb:()=>{r({...l,[c]:I})}})))??[];$.ContextMenu.set({buttons:[...b]})})},children:l!=null&&l[c]?`@${l==null?void 0:l[c]}`:o("APPS.TIKTOK.ADD_ACCOUNT").format({name:o(`APPS.${c.toUpperCase()}.TITLE`)})})]},K)),e("div",{className:"break"}),s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.SHOW_LIKES")}),e(lt,{checked:l==null?void 0:l.show_likes,onChange:()=>{r({...l,show_likes:!(l!=null&&l.show_likes)})}})]})]}),s("div",{className:"buttons",children:[e("div",{className:"button",onClick:()=>{$.PopUp.set({title:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.TITLE"),description:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.CANCEL")},{title:o("APPS.INSTAGRAM.SIGN_OUT_POPUP.PROCEED"),color:"red",cb:()=>{_("TikTok",{action:"logout"},!0).then(c=>{if(!c)return T("warning","Failed to logout");ie.APPS.TIKTOK.account.set(null),v(!1)})}}]})},children:o("APPS.TIKTOK.LOGOUT")}),e("div",{className:"button red",onClick:()=>rt("TikTok",()=>{}),children:o("APPS.TIKTOK.CHANGE_PASSWORD")}),e("div",{className:"button red",onClick:()=>{ct("TikTok",()=>{v(null),C(null),ie.APPS.TIKTOK.account.set(null)})},children:o("APPS.TIKTOK.DELETE_ACCOUNT")})]})]})]})};function xt(){var I,N,U,M,D,A,O;const{View:t,User:d}=i.useContext(B),[h]=d,[P,w]=t,[C,u]=i.useState(0),[v,l]=i.useState(!1),[r,n]=i.useState("en_us_001"),[a,c]=i.useState({src:null,caption:null,music:{title:null,artist:null,path:null,cover:null,volume:.25},metadata:{tts:null,ttsUrl:null,ttsVoice:null}}),[K,L]=i.useState(!1);i.useEffect(()=>{L(a.src&&a.caption)},[a]),i.useEffect(()=>{var f,k,m;switch(C){case 0:$.Gallery.set({allowExternal:(m=(k=(f=_e)==null?void 0:f.value)==null?void 0:k.AllowExternal)==null?void 0:m.TikTok,includeVideos:!0,includeImages:!1,onSelect:p=>{c({...a,src:p.src}),u(F=>F+1)}});break}},[C]);const b=()=>{var f,k;_("TikTok",{action:"uploadVideo",data:{src:a.src,caption:a.caption,metadata:((f=a.metadata)==null?void 0:f.ttsUrl)&&a.metadata,music:((k=a.music)==null?void 0:k.path)&&{path:a.music.path,volume:a.music.volume}}},{success:!0}).then(m=>{if(!m||m.error)return T("warning","Failed to upload video, error: "+m.error);if(!m.success)return T("warning","Failed to upload video");w("feed")})};return s("div",{className:"upload-container",children:[v&&e("div",{className:"loading",children:e(Ze,{size:40,lineWeight:5,speed:2,color:((N=(I=re.Settings)==null?void 0:I.value)==null?void 0:N.display.theme)==="dark"?"#fff":"#000"})}),C!==0&&s(te,{children:[s("div",{className:"upload-header",children:[e("div",{className:"cancel",onClick:()=>{if(C===2)return u(f=>f-1);if(C===1)return w("feed")},children:C===2?o("APPS.TIKTOK.GO_BACK"):o("APPS.TIKTOK.CANCEL")}),e("div",{className:"title",children:o("APPS.TIKTOK.UPLOAD_VIDEO")}),e("div",{className:"next","data-disabled":!K,onClick:()=>{if(K){if(C===2)return b();a!=null&&a.metadata.tts?(l(!0),Wt(a.metadata.tts,r).then(f=>{l(!1),c({...a,metadata:{...a.metadata,ttsUrl:f}}),u(k=>k+1)}).catch(f=>{l(!1),$.PopUp.set({title:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.TITLE"),description:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.CANCEL")},{title:o("APPS.TIKTOK.FAILED_UPLOAD_POPUP.PROCEED"),cb:()=>{u(k=>k+1)}}]})})):u(f=>f+1)}},children:C===1?o("APPS.TIKTOK.PREVIEW"):o("APPS.TIKTOK.SHARE")})]}),s("div",{className:"upload-body",children:[C===1&&s(te,{children:[e("div",{className:"video-placeholder",children:e("video",{src:a.src,controls:!1,autoPlay:!0,loop:!0,muted:!0})}),s("div",{className:"form",children:[s("div",{className:"item",children:[e("div",{className:"label",children:o("APPS.TIKTOK.CAPTION")}),e(ue,{defaultValue:a.caption,placeholder:o("APPS.TIKTOK.CAPTION_PLACEHOLDER"),type:"text",maxLength:100,onChange:f=>{if(f.target.value.length<=100)return c({...a,caption:f.target.value})}})]}),s("div",{className:"item",children:[s("div",{className:"label",children:[o("APPS.TIKTOK.TTS")," ",s("span",{children:["(",o("APPS.TIKTOK.OPTIONAL"),")"]})]}),e(qe,{defaultValue:(U=a==null?void 0:a.metadata)==null?void 0:U.tts,placeholder:o("APPS.TIKTOK.TTS_PLACEHOLDER"),maxLength:300,onChange:f=>{if(f.target.value.length<=300)return c({...a,metadata:{...a.metadata,tts:f.target.value}})}}),((M=a==null?void 0:a.metadata)==null?void 0:M.tts)&&e("select",{onChange:f=>n(f.target.value),children:(A=(D=_e)==null?void 0:D.value.TikTokTTS)==null?void 0:A.map(f=>e("option",{value:f[1],selected:f[1]===r,children:f[0]}))})]}),s("div",{className:"item",children:[s("div",{className:"label",children:[o("APPS.TIKTOK.MUSIC")," ",s("span",{children:["(",o("APPS.TIKTOK.OPTIONAL"),")"]})]}),s("div",{className:"button",onClick:()=>$.MusicSelector.set({onSelect:f=>c({...a,music:{...a.music,...f}})}),children:[a.music?a.music.title:o("APPS.TIKTOK.SELECT_MUSIC"),e(Ae,{onClick:f=>{f.stopPropagation(),c({...a,music:null})}})]}),((O=a.music)==null?void 0:O.title)&&s("div",{className:"slider",children:[e(ut,{}),e(Nt,{min:0,max:.5,step:.025,value:a.music.volume??.25,onChange:f=>c({...a,music:{...a.music,volume:f}})}),e(dt,{})]})]})]})]}),C===2&&e("div",{className:"preview",children:e(Ke,{data:{...a,timestamp:new Date().getTime(),id:"preview",likes:0,comments:0,saves:0,username:h.username,avatar:j(h.avatar),verified:h.verified,music:a.music},active:!0,preview:!0})})]})]})]})}const Gt=async(t,d,h)=>{const P=await fetch(t,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({text:d,voice:h})});if(!P.ok)throw new Error(`Fetch error: ${P.status} ${P.statusText}`);return P.json()},Bt=async(t,d)=>{const h=await Gt("https://tiktok-tts.weilnet.workers.dev/api/generation",t,d);if(h.success&&h.data)return h.data;throw h},Wt=async(t,d)=>{try{const h=await Bt(t,d),w=await(await fetch(`data:application/octet-stream;base64,${h}`)).arrayBuffer(),C=new Uint8Array(w),u=new Blob([C],{type:"audio/mp3"});return await mt("Audio",u)}catch(h){throw h}};function Ht(){const{View:t,User:d,Profile:h,FeedData:P}=i.useContext(B),[w,C]=d,[u,v]=t,[l,r]=h,[n,a]=P,c=[{value:"feed",label:o("APPS.TIKTOK.HOME"),activeIcon:e(ft,{}),icon:e(ht,{}),cb:()=>{v("feed"),a(null)}},{value:"discover",label:o("APPS.TIKTOK.DISCOVER"),activeIcon:e(vt,{}),icon:e(Tt,{})},{value:"upload",label:o("APPS.TIKTOK.UPLOAD"),activeIcon:e(be,{}),icon:e(be,{})},{value:"inbox",label:o("APPS.TIKTOK.INBOX"),activeIcon:e(gt,{}),icon:e(xe,{})},{value:"profile",label:o("APPS.TIKTOK.PROFILE"),activeIcon:e(Pt,{}),icon:e(pt,{}),cb:()=>{r(w),v("profile")}}];return e("div",{className:"tiktok-footer","data-feed":u==="feed",children:c.map((K,L)=>{let b=u===K.value;return s("div",{className:"item","data-active":b,onClick:()=>K.cb?K.cb():v(K.value),children:[b?K.activeIcon:K.icon,K.label]},L)})})}function $t(){const{User:t,ShareComponent:d,View:h}=i.useContext(B),[P]=t,[w,C]=h,[u,v]=d,[l,r]=i.useState([]);i.useState(!1);const[n,a]=i.useState(u==null?void 0:u.pinned);return i.useEffect(()=>{_("TikTok",{action:"getRecentMessages"},{success:!0,channels:Z.Messages}).then(c=>{if(!(c!=null&&c.success))return T("warning",c.error);r(c.channels.sort((K,L)=>L.timestamp-K.timestamp))})},[]),e("div",{className:"share-container",onClick:()=>v(null),children:s(se.div,{...Pe,className:"share-wrapper",onClick:c=>c.stopPropagation(),children:[e("div",{className:"share-header",children:o("APPS.TIKTOK.SHARE_TITLE")}),s("div",{className:"share-body",children:[e("div",{className:"friends",children:l.map(c=>e(qt,{data:{username:c.username,name:c.name,avatar:c.avatar,verified:c.verified}}))}),s("div",{className:"options",children:[s("div",{className:"item",children:[e(St,{}),o("APPS.TIKTOK.REPORT")]}),P.username===(u==null?void 0:u.username)&&s(te,{children:[s("div",{className:"item",onClick:()=>{$.PopUp.set({title:o("APPS.TIKTOK.PIN_VIDEO_POPUP.TITLE"),description:o("APPS.TIKTOK.PIN_VIDEO_POPUP.DESCRIPTION").format({action:n?o("APPS.TIKTOK.UNPIN"):o("APPS.TIKTOK.PIN")}),buttons:[{title:o("APPS.TIKTOK.PIN_VIDEO_POPUP.CANCEL")},{title:o("APPS.TIKTOK.PIN_VIDEO_POPUP.PROCEED"),color:n?"red":null,cb:()=>{_("TikTok",{action:"togglePinnedVideo",id:u==null?void 0:u.id,toggle:!n},{success:!0}).then(c=>{if(c!=null&&c.success||T("warning",c.error),c!=null&&c.error&&c.error==="max_pinned")return $.PopUp.set({title:o("APPS.TIKTOK.MAX_PINNED_TITLE"),description:o("APPS.TIKTOK.MAX_PINNED_DESCRIPTION"),buttons:[{title:o("APPS.TIKTOK.OK")}]});a(!n)})}}]})},children:[e(Ct,{}),n?o("APPS.TIKTOK.UNPIN_VIDEO"):o("APPS.TIKTOK.PIN_VIDEO")]}),s("div",{className:"item",onClick:()=>{$.PopUp.set({title:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.TITLE"),description:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.DESCRIPTION"),buttons:[{title:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.CANCEL")},{title:o("APPS.TIKTOK.DELETE_VIDEO_POPUP.PROCEED"),color:"red",cb:()=>{_("TikTok",{action:"deleteVideo",id:u==null?void 0:u.id},{success:!0}).then(c=>{c!=null&&c.success||T("warning",c.error),v(null),C("profile")})}}]})},children:[e(It,{}),o("APPS.TIKTOK.DELETE")]})]})]})]}),e("div",{className:"share-footer",onClick:()=>v(null),children:o("APPS.TIKTOK.CANCEL")})]})})}const qt=t=>{const{ShareComponent:d}=i.useContext(B),[h]=d,[P,w]=i.useState(!1);return s("div",{className:"item","data-sent":P,onClick:()=>{if(P)return T("warning","You have already sent this video to this user!");_("TikTok",{action:"sendMessage",data:{username:t.data.username,content:`<!SHARED-VIDEO-URL="${h.src}"ID="${h.id}"!>`}},{success:!0}).then(u=>{if(!(u!=null&&u.success))return T("warning",u.error);T("info","Successfully sent video to user!"),w(!0)})},children:[e("img",{src:j(t.data.avatar)}),e("div",{className:"name",children:t.data.name}),P&&e(De,{className:"checkmark"})]})};function Zt(){const{UserPanel:t}=i.useContext(B),[d,h]=t,[P,w]=i.useState([]),[C,u]=i.useState(d==null?void 0:d.value),[v,l]=i.useState(0),[r,n]=i.useState(!1),[a,c]=i.useState(!1),K={following:"getFollowing",followers:"getFollowers"},L={following:o("APPS.TIKTOK.FOLLOWING"),followers:o("APPS.TIKTOK.FOLLOWERS")},b=(N,U)=>{var D,A;return(N===o("APPS.TIKTOK.FOLLOWING")?(D=Z.Accounts[U])==null?void 0:D.following:((A=Z.Accounts[U])==null?void 0:A.followers)??[]).map(O=>Z.Accounts[O])};i.useEffect(()=>{!d||!(d!=null&&d.value)||C&&_("TikTok",{action:K[C],username:d.username,page:0},b(K[C],d.username)).then(N=>{if(!N)return T("warning","No data returned from tiktok event");w(N)})},[C]);const I=()=>{if(r||a)return;!he(document.querySelector("#last"))&&(c(!0),_("TikTok",{action:K[d.value],username:d.username,page:v+1},null).then(U=>{U&&U.length>0?(w([...P,...U]),c(!1)):n(!0)}),l(U=>U+1))};return s(se.div,{...Pe,className:"userpanel-container",children:[s("div",{className:"userpanel-header",children:[e("div",{onClick:()=>h(null),children:e(ve,{})}),e("div",{className:"title",children:d==null?void 0:d.username}),e("div",{})]}),e("div",{className:"userpanel-selector",children:["following","followers"].map(N=>s("div",{className:"item","data-active":C===N,onClick:()=>u(N),children:[L[N]," ",X(d==null?void 0:d[N])??0]}))}),e("div",{className:"userpanel-content",onScroll:I,children:P.map((N,U)=>e(zt,{data:N,last:U===P.length-1}))})]})}const zt=({data:t,last:d})=>{const{Func:h,UserPanel:P}=i.useContext(B),[w,C]=P,[u,v]=i.useState(t.isFollowing),l=r=>{_("TikTok",{action:"toggleFollow",data:{username:t.username,follow:r}}).then(n=>{if(!n||!(n!=null&&n.success))return T("warning","Failed to toggle follow");if(n.error)return T("error",n.error);v(r)})};return s("div",{className:"item",id:d?"last":"",onClick:()=>{h.fetchAndSetProfile(t.username),C(null)},children:[s("div",{className:"item-user",children:[e("div",{className:"avatar",children:e("img",{src:j(t.avatar)})}),s("div",{className:"user",children:[s("div",{className:"name",children:[t.name," ",t.verified&&e(me,{})]}),e("div",{className:"username",children:t.username})]})]}),e("div",{className:"action",children:e("div",{className:de("button",u?"following":"follow"),onClick:r=>{r.stopPropagation(),u?$.PopUp.set({title:o("APPS.TIKTOK.UNFOLLOW_POPUP.TITLE"),description:o("APPS.TIKTOK.UNFOLLOW_POPUP.DESCRIPTION").format({name:t.name}),buttons:[{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.CANCEL")},{title:o("APPS.TIKTOK.UNFOLLOW_POPUP.PROCEED"),color:"red",cb:()=>l(!1)}]}):l(!0)},children:u?o("APPS.TIKTOK.UNFOLLOW"):o("APPS.TIKTOK.FOLLOW")})})]})};const B=i.createContext(null);function Jt(){const t=fe(re.Settings),[d,h]=i.useState(null),[P,w]=i.useState("feed"),[C,u]=i.useState(null),[v,l]=i.useState(null),[r,n]=i.useState(null),[a,c]=i.useState(null),[K,L]=i.useState(null),[b,I]=i.useState(null),[N,U]=i.useState(!1),[M,D]=i.useState(null),[A,O]=i.useState(!0),[f,k]=i.useState(!0);i.useEffect(()=>{_("isAdmin",null,!1).then(y=>{if(ie.APPS.TIKTOK.account.value){h({...ie.APPS.TIKTOK.account.value,isAdmin:y}),U(!0),O(!1);return}else if(ie.APPS.TIKTOK.account.value===!1)return O(!1);_("TikTok",{action:"isLoggedIn"},Z.Account).then(G=>{G?(ie.APPS.TIKTOK.account.set(G),h({...G,isAdmin:y}),U(!0),O(!1)):(ie.APPS.TIKTOK.account.set(!1),O(!1))})})},[]),i.useEffect(()=>{P==="feed"&&C||P==="profile"&&(C==null?void 0:C.username)!==d.username?k(!1):k(!0)},[C]);const m={profile:e(Vt,{}),video:e(Ke,{}),discover:e(Ot,{}),inbox:e(Lt,{}),messages:e(kt,{}),dm:e(bt,{}),upload:e(xt,{}),feed:e(Ue,{})},p=y=>{if(!y)return T("warning","Couldn't fetch profile (no username provided)");T("info",`Fetching profile ${y}`),_("TikTok",{action:"getProfile",username:y},Z.Accounts.find(G=>G.username===y)).then(G=>{if(!G)return T("warning","Couldn't fetch profile");u(G),w("profile")})},F=(y,G)=>{_("TikTok",{action:"getVideo",id:y},{video:Z.Videos.find(H=>H.id===y)}).then(H=>{if(!H)return T("warning","Couldn't fetch video");if(H.error)return T("warning",H.error);if(!(H!=null&&H.video))return T("warning","Couldn't fetch video");L({video:H.video,args:G}),w("feed")})};return e(B.Provider,{value:{User:[d,h],View:[P,w],Profile:[C,u],LoggedIn:[N,U],FeedData:[K,L],UserPanel:[r,n],ShareComponent:[a,c],GoBack:[b,I],Video:[M,D],Dm:[v,l],Func:{fetchAndSetProfile:p,fetchAndSetVideo:F}},children:A||t!=null&&t.airplaneMode?e("div",{className:"loading",children:e(Ze,{size:40,lineWeight:5,speed:2,color:(t==null?void 0:t.display.theme)==="dark"?"#ffffff":"#000000"})}):e("div",{className:"tiktok-container","data-infeed":P==="feed",children:N===!0?s(te,{children:[s("div",{className:"tiktok-wrapper","data-profile":!f,children:[e(Ue,{}),P!=="feed"&&e(se.div,{...$e(P=="discover"||P=="messages"?"right":"left",P),className:"tiktok-content",children:m==null?void 0:m[P]}),e(ge,{children:r&&e(Zt,{})})]}),e(ge,{children:a&&e($t,{})}),f&&e(Ht,{})]}):e(yt,{})})})}const j=t=>{var d;return t??`./assets/img/avatar-placeholder-${(d=re.Settings.value)==null?void 0:d.display.theme}.svg`},Ce=t=>{if(!t)return;const d=new Date(t),P=new Date().getTime()-d.getTime(),w=Math.floor(P/(1e3*3600*24)),C=Math.floor(P/(1e3*3600)),u=Math.floor(P/(1e3*60)),v=Math.floor(P/1e3);return w>0?`${d.getMonth()+1}-${d.getDate()}`:C>0?`${C}h`:u>0?`${u}m`:v>0?`${v}s`:o("NOW")};function X(t){if(t<1e4)return t;if(t>=1e4&&t<1e6)return`${(t/1e3).toFixed(1)}K`;if(t>=1e6&&t<1e9)return`${(t/1e6).toFixed(1)}M`}export{B as TikTokContext,Jt as default,Ce as formatDate,X as formatNumber,j as getAvatar};
